# GENERATED BY optimus-cli â€” DO NOT EDIT
# Java Execution Environment - Optimized for Cold Start
FROM eclipse-temurin:17-jdk-alpine

# Set environment variables for performance
ENV JAVA_TOOL_OPTIONS="-XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0 -XX:+TieredCompilation -XX:TieredStopAtLevel=1" \
    LANGUAGE=java

WORKDIR /code

# Install JUnit and bash at build time (bash needed for runner.sh)
RUN apk add --no-cache wget bash && \
    wget -q https://repo1.maven.org/maven2/junit/junit/4.13.2/junit-4.13.2.jar -P /opt/ && \
    wget -q https://repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar -P /opt/ && \
    apk del wget && \
    rm -rf /var/cache/apk/*

ENV CLASSPATH=/opt/junit-4.13.2.jar:/opt/hamcrest-core-1.3.jar

# Copy universal runner script (build context is repo root)
COPY dockerfiles/runner.sh /runner.sh
RUN chmod +x /runner.sh

# Create non-root user for security
RUN adduser -D -u 1000 optimus && \
    chown -R optimus:optimus /code

USER optimus

# Use universal runner
ENTRYPOINT ["/runner.sh"]
